---
# tasks for storage role
- name: Install snapraid
  ansible.builtin.yum:
    name: snapraid
    state: present

- name: Find disks labeled data-*
  ansible.builtin.find:
    paths: /dev/disk/by-label
    patterns: "data-*"
    file_type: any
  register: data_disk_find

- name: Set fact for data disks
  ansible.builtin.set_fact:
    data_disks: "{{ data_disk_find.files | map(attribute='path') | list }}"

- name: Create mount points
  ansible.builtin.file:
    path: "/mnt/{{ item | basename }}"
    state: directory
    owner: root
    group: root
    mode: "0755"
  loop: "{{ data_disks }}"
  when: data_disks | length > 0

- name: Mount data disks
  ansible.builtin.mount:
    path: "/mnt/{{ item | basename }}"
    src: "{{ item }}"
    fstype: ext4
    state: mounted
  loop: "{{ data_disks }}"
  when: data_disks | length > 0
